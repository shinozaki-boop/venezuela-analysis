<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>石油レンティア国家の政治経済学</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* カスタムスクロールバー等、Tailwindで補いきれない微調整 */
        body {
            font-family: 'Helvetica Neue', Arial, 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', Meiryo, sans-serif;
            background-color: #f8fafc;
        }
        .chart-container {
            position: relative;
            width: 100%;
            height: 400px;
        }
        .small-chart-container {
            position: relative;
            width: 100%;
            height: 300px;
        }
        /* アコーディオンのアニメーション用 */
        .submenu-container {
            transition: max-height 0.3s ease-in-out, opacity 0.3s ease-in-out;
            max-height: 0;
            opacity: 0;
            overflow: hidden;
        }
        .submenu-container.open {
            max-height: 1000px; /* 十分に大きい値 */
            opacity: 1;
        }
    </style>
</head>
<body class="text-slate-900">

    <!-- ヘッダー -->
    <header class="bg-white border-b border-slate-200 sticky top-0 z-50 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 md:px-8 py-4">
            <h1 class="text-2xl font-black text-slate-800 tracking-tight flex items-center gap-2">
                <i data-lucide="globe" class="text-blue-600 w-7 h-7"></i> 石油レンティア国家の政治経済学
            </h1>
            <p class="text-xs text-slate-500 mt-1 uppercase tracking-widest font-bold">開発、独裁、そして国家の解体への道程</p>
        </div>
    </header>

    <!-- メインコンテンツ -->
    <div class="max-w-7xl mx-auto px-4 md:px-8 py-6">
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6 md:gap-8">
            
            <!-- 左側：サイドバー -->
            <div class="lg:col-span-1 space-y-4" id="sidebar-menu">
                <!-- JSで動的にメニューが生成されます -->
            </div>
            
            <!-- 右側：コンテンツエリア -->
            <div class="lg:col-span-3" id="main-content">
                <!-- JSで動的にコンテンツが生成されます -->
            </div>

        </div>
    </div>

    <script>
        // ==========================================
        // 1. データ定義
        // ==========================================
        const jp_gdp_pts = [[1958, 350], [1970, 2000], [1980, 9500], [1990, 25000], [1995, 43000], [2010, 44000], [2025, 34000]];
        const ve_gdp_pts = [[1958, 1000], [1970, 1200], [1980, 4500], [1990, 2500], [1998, 3000], [2008, 11000], [2013, 12000], [2018, 3500], [2025, 3000]];
        const la_gdp_pts = [[1958, 400], [1980, 2500], [1990, 2000], [2000, 4000], [2013, 10000], [2025, 9000]];
        const no_gdp_pts = [[1958, 1300], [1980, 14000], [1990, 28000], [2010, 87000], [2025, 95000]];
        const ru_gdp_pts = [[1958, 800], [1989, 3400], [1999, 1300], [2008, 11000], [2013, 16000], [2020, 10000], [2025, 13000]];
        const sa_gdp_pts = [[1958, 300], [1980, 16000], [1990, 6500], [2000, 8500], [2012, 25000], [2020, 20000], [2025, 32000]];
        const ng_gdp_pts = [[1958, 100], [1980, 800], [1990, 300], [2000, 400], [2014, 3200], [2025, 1500]];
        const my_gdp_pts = [[1958, 200], [1980, 1800], [1990, 2400], [2000, 4000], [2010, 9000], [2025, 12000]];

        const ve_prod_pts = [[1958, 2.6], [1970, 3.7], [1985, 1.7], [1998, 3.3], [2008, 2.4], [2015, 2.4], [2020, 0.5], [2025, 0.8]];
        const no_prod_pts = [[1958, 0], [1971, 0], [1980, 0.5], [1990, 1.7], [2001, 3.4], [2010, 2.1], [2020, 2.0], [2025, 1.9]];
        const ru_prod_pts = [[1958, 2.0], [1980, 11.0], [1988, 11.4], [1996, 6.0], [2010, 10.0], [2019, 11.5], [2025, 9.5]];
        const sa_prod_pts = [[1958, 1.0], [1970, 3.8], [1980, 9.9], [1985, 3.4], [1995, 8.2], [2005, 9.4], [2015, 10.5], [2025, 9.5]];
        const ng_prod_pts = [[1958, 0.01], [1970, 1.0], [1979, 2.3], [1985, 1.5], [2000, 2.1], [2005, 2.5], [2015, 2.3], [2025, 1.3]];
        const my_prod_pts = [[1958, 0], [1980, 0.3], [1990, 0.6], [2000, 0.7], [2010, 0.6], [2025, 0.5]];

        const world_oil_price_pts = [[1958, 3], [1970, 3], [1974, 12], [1980, 37], [1986, 14], [1998, 11], [2008, 97], [2009, 61], [2011, 111], [2014, 93], [2016, 43], [2020, 39], [2022, 100], [2025, 75]];

        const ve_rev_pts = [[1958, 50], [1980, 70], [1998, 50], [2008, 90], [2020, 95], [2025, 90]];
        const no_rev_pts = [[1958, 0], [1980, 10], [2000, 20], [2008, 35], [2020, 15], [2022, 40], [2025, 25]];
        const ru_rev_pts = [[1958, 10], [1980, 30], [1998, 15], [2008, 50], [2015, 40], [2025, 35]];
        const sa_rev_pts = [[1958, 80], [1980, 95], [2000, 85], [2010, 90], [2020, 60], [2025, 65]];
        const ng_rev_pts = [[1958, 2], [1980, 80], [2000, 75], [2010, 70], [2020, 50], [2025, 45]];
        const my_rev_pts = [[1958, 0], [1980, 25], [1990, 20], [2000, 30], [2010, 25], [2025, 20]];

        const ve_gdp_oil_pts = [[1958, 20], [1980, 30], [1998, 15], [2008, 30], [2020, 15], [2025, 10]];
        const no_gdp_oil_pts = [[1958, 0], [1980, 8], [2000, 15], [2008, 25], [2020, 10], [2022, 25], [2025, 15]];
        const ru_gdp_oil_pts = [[1958, 5], [1980, 15], [1998, 8], [2008, 20], [2015, 15], [2025, 15]];
        const sa_gdp_oil_pts = [[1958, 40], [1980, 60], [2000, 40], [2010, 45], [2020, 30], [2025, 35]];
        const ng_gdp_oil_pts = [[1958, 1], [1980, 30], [2000, 20], [2010, 15], [2020, 8], [2025, 6]];
        const my_gdp_oil_pts = [[1958, 0], [1980, 15], [1990, 12], [2000, 10], [2010, 8], [2025, 5]];

        const jp_dem_pts = [[1958, 8], [1990, 9], [2025, 8.5]];
        const ve_dem_pts = [[1958, 5], [1970, 7], [1990, 7], [1999, 6.5], [2005, 5], [2015, 3], [2025, 1.5]];
        const la_dem_pts = [[1958, 4], [1975, 2.5], [1990, 6], [2005, 6.5], [2025, 5.5]];
        const no_dem_pts = [[1958, 9.5], [2025, 10]];
        const ru_dem_pts = [[1958, 1], [1985, 1.5], [1992, 5], [2000, 4], [2010, 2.5], [2025, 1]];
        const sa_dem_pts = [[1958, 0], [2025, 0.5]];
        const ng_dem_pts = [[1958, 3], [1966, 1], [1979, 4], [1983, 1], [1999, 4.5], [2025, 4]];
        const my_dem_pts = [[1958, 6], [1980, 5], [1990, 4.5], [2000, 6], [2010, 6.5], [2025, 7]];

        const jp_cor_pts = [[1958, 60], [1990, 70], [2025, 73]];
        const ve_cor_pts = [[1958, 40], [1990, 30], [2005, 25], [2015, 15], [2025, 13]];
        const la_cor_pts = [[1958, 40], [2000, 35], [2025, 38]];
        const no_cor_pts = [[1958, 80], [2025, 84]];
        const ru_cor_pts = [[1958, 30], [1995, 20], [2010, 25], [2025, 26]];
        const sa_cor_pts = [[1958, 30], [2000, 40], [2020, 53], [2025, 52]];
        const ng_cor_pts = [[1958, 30], [1990, 10], [2010, 24], [2025, 25]];
        const my_cor_pts = [[1958, 40], [1980, 50], [1990, 48], [2000, 45], [2010, 44], [2025, 50]];

        const jp_gov_pts = [[1958, 0.5], [1990, 1.5], [2025, 1.6]];
        const ve_gov_pts = [[1958, 0.0], [1990, -0.2], [2000, -0.8], [2015, -1.5], [2025, -1.8]];
        const la_gov_pts = [[1958, -0.1], [2000, -0.2], [2025, -0.3]];
        const no_gov_pts = [[1958, 1.2], [2025, 1.9]];
        const ru_gov_pts = [[1958, -0.5], [1995, -1.2], [2005, -0.4], [2025, -0.6]];
        const sa_gov_pts = [[1958, -0.8], [2000, 0.0], [2020, 0.5], [2025, 0.4]];
        const ng_gov_pts = [[1958, -0.5], [1995, -1.2], [2015, -1.0], [2025, -1.1]];
        const my_gov_pts = [[1958, 0.2], [1980, 0.8], [1990, 0.9], [2000, 1.0], [2010, 1.1], [2025, 1.1]];

        const jp_gini_pts = [[1958, 35], [1980, 28], [2000, 32], [2025, 33]];
        const ve_gini_pts = [[1958, 50], [1990, 52], [2005, 42], [2015, 55], [2025, 65]]; 
        const la_gini_pts = [[1958, 55], [1990, 56], [2010, 50], [2025, 51]];
        const no_gini_pts = [[1958, 28], [1980, 23], [2025, 27]];
        const ru_gini_pts = [[1958, 25], [1995, 48], [2010, 38], [2025, 36]];
        const sa_gini_pts = [[1958, 45], [2000, 42], [2025, 45]];
        const ng_gini_pts = [[1958, 45], [1990, 48], [2010, 43], [2025, 35]];
        const my_gini_pts = [[1958, 50], [1980, 48], [1990, 46], [2000, 46], [2010, 43], [2025, 41]];

        const jp_hdi_pts = [[1958, 0.65], [1980, 0.80], [2000, 0.88], [2025, 0.92]];
        const ve_hdi_pts = [[1958, 0.55], [1980, 0.68], [2000, 0.68], [2012, 0.77], [2020, 0.70], [2025, 0.69]];
        const la_hdi_pts = [[1958, 0.45], [1980, 0.60], [2000, 0.68], [2025, 0.76]];
        const no_hdi_pts = [[1958, 0.70], [1980, 0.82], [2000, 0.92], [2025, 0.96]];
        const ru_hdi_pts = [[1958, 0.60], [1980, 0.75], [1995, 0.70], [2015, 0.82], [2025, 0.82]];
        const sa_hdi_pts = [[1958, 0.30], [1980, 0.60], [2000, 0.73], [2025, 0.87]];
        const ng_hdi_pts = [[1958, 0.20], [1980, 0.40], [2000, 0.43], [2025, 0.54]];
        const my_hdi_pts = [[1958, 0.4], [1980, 0.6], [1990, 0.65], [2000, 0.75], [2010, 0.77], [2025, 0.81]];

        const ptsMap = {
            gdp_per_capita: { jp: jp_gdp_pts, ve: ve_gdp_pts, la: la_gdp_pts, no: no_gdp_pts, ru: ru_gdp_pts, sa: sa_gdp_pts, ng: ng_gdp_pts, my: my_gdp_pts },
            oil_production: { ve: ve_prod_pts, no: no_prod_pts, ru: ru_prod_pts, sa: sa_prod_pts, ng: ng_prod_pts, my: my_prod_pts },
            oil_price: { world: world_oil_price_pts },
            oil_revenue_gov: { ve: ve_rev_pts, no: no_rev_pts, ru: ru_rev_pts, sa: sa_rev_pts, ng: ng_rev_pts, my: my_rev_pts },
            oil_revenue_gdp: { ve: ve_gdp_oil_pts, no: no_gdp_oil_pts, ru: ru_gdp_oil_pts, sa: sa_gdp_oil_pts, ng: ng_gdp_oil_pts, my: my_gdp_oil_pts },
            democracy: { jp: jp_dem_pts, ve: ve_dem_pts, la: la_dem_pts, no: no_dem_pts, ru: ru_dem_pts, sa: sa_dem_pts, ng: ng_dem_pts, my: my_dem_pts },
            corruption: { jp: jp_cor_pts, ve: ve_cor_pts, la: la_cor_pts, no: no_cor_pts, ru: ru_cor_pts, sa: sa_cor_pts, ng: ng_cor_pts, my: my_cor_pts },
            gov_effectiveness: { jp: jp_gov_pts, ve: ve_gov_pts, la: la_gov_pts, no: no_gov_pts, ru: ru_gov_pts, sa: sa_gov_pts, ng: ng_gov_pts, my: my_gov_pts },
            gini: { jp: jp_gini_pts, ve: ve_gini_pts, la: la_gini_pts, no: no_gini_pts, ru: ru_gini_pts, sa: sa_gini_pts, ng: ng_gini_pts, my: my_gini_pts },
            hdi: { jp: jp_hdi_pts, ve: ve_hdi_pts, la: la_hdi_pts, no: no_hdi_pts, ru: ru_hdi_pts, sa: sa_hdi_pts, ng: ng_hdi_pts, my: my_hdi_pts },
        };

        const allEntities = [
            { key: 'jp', name: '日本', level: 'Non-Rentier', color: '#ef4444', desc: '非資源国比較' },
            { key: 've', name: 'ベネズエラ', level: 'L4', color: '#f59e0b', desc: '略奪型・機能不全' },
            { key: 'la', name: 'ラテンアメリカ平均', level: 'Avg', color: '#8b5cf6', desc: '地域平均' },
            { key: 'no', name: 'ノルウェー', level: 'L1', color: '#10b981', desc: '制度的民主制' },
            { key: 'my', name: 'マレーシア', level: 'L2', color: '#0ea5e9', desc: '開発志向体制' },
            { key: 'ru', name: 'ロシア', level: 'L3', color: '#8b5cf6', desc: '権威主義的抽出' },
            { key: 'sa', name: 'サウジアラビア', level: 'L3', color: '#ec4899', desc: '分配型・洗練された独裁' },
            { key: 'ng', name: 'ナイジェリア', level: 'L4', color: '#14b8a6', desc: '不安定な略奪' },
            { key: 'world', name: '世界基準価格', level: 'Avg', color: '#111827', desc: '' },
        ];

        // 難民・移民データ 
        const migrationData = [
            { country: 'コロンビア', value: 2.87, color: '#3b82f6' },
            { country: 'ペルー', value: 1.54, color: '#10b981' },
            { country: '米国 (推定)', value: 0.545, color: '#4f46e5' },
            { country: 'ブラジル', value: 0.51, color: '#f59e0b' },
            { country: 'スペイン', value: 0.477, color: '#8b5cf6' },
            { country: 'エクアドル', value: 0.475, color: '#ef4444' },
            { country: 'チリ', value: 0.444, color: '#0ea5e9' },
            { country: 'アルゼンチン', value: 0.22, color: '#f43f5e' }
        ].sort((a, b) => b.value - a.value);

        const consejosData = [
            { year: '2006', value: 15000 }, { year: '2008', value: 30000 }, { year: '2010', value: 36000 },
            { year: '2013', value: 43000 }, { year: '2016', value: 45000 }, { year: '2019', value: 47000 },
            { year: '2022', value: 49000 }, { year: '2024', value: 49500 }
        ];

        const clapData = [
            { year: '2016', value: 26000 }, { year: '2017', value: 32000 }, { year: '2018', value: 34000 },
            { year: '2020', value: 36000 }, { year: '2022', value: 38000 }, { year: '2024', value: 40000 }
        ];

        const corruptionData = [
            { name: 'プントフィホ期 (25年間推計)', value: 100, color: '#94a3b8' },
            { name: 'チャベス期 (CADIVI・架空輸入)', value: 300, color: '#3b82f6' },
            { name: 'マドゥロ期 (PDVSA-Cripto事件)', value: 21, color: '#e11d48' }
        ];

        const militaryCabinetData = [
            { year: '1958-1998(平均)', value: 3, era: 'puntofijo' },
            { year: '2004(チャベス初期)', value: 25, era: 'chavez' },
            { year: '2008(チャベス後期)', value: 30, era: 'chavez' },
            { year: '2014(マドゥロ初期)', value: 25, era: 'maduro' },
            { year: '2017(危機ピーク)', value: 43, era: 'maduro' },
            { year: '2020(マドゥロ)', value: 35, era: 'maduro' },
            { year: '2024(現在)', value: 30, era: 'maduro' }
        ];

        const VZLA_EVENTS = [
            { year: 1999, label: '1999 憲法改正' },
            { year: 2003, label: '2002–03 PDVSA危機' },
            { year: 2005, label: '2005 FONDEN' },
            { year: 2014, label: '2014 逆オイルショック' },
            { year: 2017, label: '2017 制憲議会' },
            { year: 2019, label: '2019 制裁強化期' },
            { year: 2020, label: '2020 COVID' },
        ];

        const MENU_GROUPS = [
            {
                title: "主要指標の推移",
                items: [
                    { id: 'gdp_per_capita', name: '一人あたりのGDP (USD)', format: 'currency', type: 'line', icon: 'line-chart' },
                    { id: 'oil_production', name: '石油生産量 (百万バレル/日)', format: 'number', type: 'line', icon: 'droplet' },
                    { id: 'oil_price', name: '石油価格の推移 (USD/バレル)', format: 'currency', type: 'line', icon: 'dollar-sign' },
                    { id: 'oil_revenue_gov', name: '国家収入に占める石油収入 (%)', format: 'percent', type: 'line', icon: 'percent' },
                    { id: 'oil_revenue_gdp', name: 'GDPに占める石油収入 (%)', format: 'percent', type: 'line', icon: 'pie-chart' },
                    { id: 'democracy', name: '民主化指数 (0〜10点)', format: 'number', type: 'line', icon: 'vote' },
                    { id: 'corruption', name: '汚職指数 (0〜100点: クリーンなほど高)', format: 'number', type: 'line', icon: 'shield-alert' },
                    { id: 'gov_effectiveness', name: '政府の有効性 (-2.5〜2.5)', format: 'number', type: 'line', icon: 'building' },
                    { id: 'gini', name: 'ジニ係数 (0〜100: 不平等なほど高)', format: 'number', type: 'line', icon: 'scale' },
                    { id: 'hdi', name: '人間開発指数 (HDI: 0〜1)', format: 'number', type: 'line', icon: 'user' },
                ]
            },
            {
                title: "分析・レポート",
                items: [
                    { id: 'view_overview', name: '概論：レンティア国家', type: 'custom', icon: 'book-open' },
                    { id: 'view_levels', name: '統治レベル分類 (L1-L4)', type: 'custom', icon: 'layers' },
                    { id: 'view_comparative', name: '比較分析：能力と民主化', type: 'custom', icon: 'bar-chart-3' },
                    { id: 'view_diversification', name: 'オランダ病と経済多角化', type: 'custom', icon: 'factory' },
                ]
            },
            {
                title: "深層分析：ベネズエラ",
                items: [
                    { id: 'view_exodus', name: '国外脱出と頭脳流出', type: 'custom', icon: 'users' },
                    { id: 'view_social_control', name: '住民組織・配給・コレクティーボ', type: 'custom', icon: 'network' },
                    { id: 'view_corruption_cases', name: '歴代政権の汚職と公金消失', type: 'custom', icon: 'dollar-sign' },
                    { id: 'view_military_control', name: '軍の政治・経済支配の変遷', type: 'custom', icon: 'crosshair' },
                    { id: 'vzla_fonden', name: 'パラレル予算 (FONDEN)', format: 'number', unit: 'Billion USD', type: 'bar', icon: '' },
                    { id: 'vzla_pdvsa', name: 'PDVSA稼働率推移', format: 'percent', unit: '%', type: 'area', icon: '' },
                    { id: 'vzla_hire', name: '公務員雇用構造の変容', format: 'percent', unit: '%', type: 'stacked_area', icon: '' },
                ]
            }
        ];

        const allMetricsList = MENU_GROUPS.flatMap(g => g.items).filter(i => i.type !== 'custom');

        // ==========================================
        // 2. ユーティリティとデータ生成
        // ==========================================
        const clamp = (v, min, max) => Math.min(max, Math.max(min, v));
        const lerp = (year, points) => {
            for (let i = 0; i < points.length - 1; i++) {
                if (year >= points[i][0] && year <= points[i+1][0]) {
                    const rangeY = points[i+1][0] - points[i][0];
                    const progress = (year - points[i][0]) / rangeY;
                    return points[i][1] + progress * (points[i+1][1] - points[i][1]);
                }
            }
            if (year < points[0][0]) return points[0][1];
            return points[points.length-1][1];
        };

        let chartData = [];
        for (let year = 1958; year <= 2025; year++) {
            const row = { year };
            
            Object.keys(ptsMap).forEach(metric => {
                Object.keys(ptsMap[metric]).forEach(entity => {
                    let noiseAmt = 0.03; 
                    if (['democracy', 'gov_effectiveness', 'hdi'].includes(metric)) noiseAmt = 0.005;
                    if (['oil_price', 'oil_production'].includes(metric)) noiseAmt = 0.06;
                    
                    const baseValue = lerp(year, ptsMap[metric][entity]);
                    const finalValue = baseValue * (1 + (Math.random() - 0.5) * noiseAmt);
                    row[`${entity}_${metric}`] = (metric === 'gov_effectiveness') ? finalValue : Math.max(0, finalValue);
                });
            });

            let oilPrice = row['world_oil_price'] || 30;
            
            let vzlaParallelBudget = 0;
            if (year >= 2005) {
                vzlaParallelBudget = Math.max(0, (oilPrice - 30) * 0.5 + Math.random() * 5);
                if (year > 2014) vzlaParallelBudget *= Math.pow(0.8, year - 2014);
            }
            row.vzla_fonden = parseFloat(vzlaParallelBudget.toFixed(2));

            let pdvsaUtil = 92;
            if (year > 1998 && year <= 2003) pdvsaUtil = 85 - (year - 1998) * 5;
            if (year > 2003 && year <= 2012) pdvsaUtil = 75 + Math.random() * 5;
            if (year > 2012) pdvsaUtil = 75 - Math.pow(year - 2012, 1.6) * 4;
            row.vzla_pdvsa = parseFloat(clamp(pdvsaUtil, 0, 100).toFixed(1));

            let regularGov = 100;
            let missionGov = 0;
            if (year >= 2003) {
                missionGov = Math.min(60, (year - 2003) * 4);
                regularGov = 100 - missionGov;
            }
            row.vzla_regular = regularGov;
            row.vzla_mission = missionGov;

            chartData.push(row);
        }

        const latestData = chartData[chartData.length - 1];

        const formatYAxis = (value, format) => {
            if (format === 'currency') return `$${Number(value).toLocaleString()}`;
            if (format === 'percent') return `${value}%`;
            return value;
        };

        // ==========================================
        // 3. アプリケーションの状態管理
        // ==========================================
        let state = {
            selectedMenuItem: 'view_overview',
            openGroups: { 0: false, 1: true, 2: false } // 初期状態で「分析・レポート」を開く
        };

        // アクティブなChart.jsインスタンスを保持する配列
        let activeCharts = [];

        // ==========================================
        // 4. UIレンダリング関数
        // ==========================================
        function renderSidebar() {
            const sidebar = document.getElementById('sidebar-menu');
            let html = '';

            MENU_GROUPS.forEach((group, groupIdx) => {
                const isOpen = state.openGroups[groupIdx];
                
                let itemsHtml = group.items.map(item => {
                    const isSpecial = group.title === "深層分析：ベネズエラ";
                    const isSelected = state.selectedMenuItem === item.id;
                    
                    let btnClass = isSelected 
                        ? (isSpecial ? 'bg-amber-100 text-amber-800 font-bold border-l-4 border-amber-500' : 'bg-blue-50 text-blue-700 font-bold border-l-4 border-blue-600')
                        : 'hover:bg-gray-100 text-gray-600 border-l-4 border-transparent';
                    
                    let iconHtml = '';
                    if (item.icon) {
                        let iconColorClass = isSelected ? (isSpecial ? "text-amber-700" : "text-blue-600") : "text-gray-400";
                        iconHtml = `<i data-lucide="${item.icon}" class="w-4 h-4 ${iconColorClass}"></i>`;
                    } else if (isSpecial) {
                        iconHtml = `<i data-lucide="alert-triangle" class="w-4 h-4 text-amber-500 opacity-70"></i>`;
                    }

                    return `
                        <button onclick="selectMenu('${item.id}', ${groupIdx})" class="w-full flex items-center gap-2 text-left px-3 py-2 rounded-lg text-sm transition-all duration-200 ${btnClass}">
                            ${iconHtml}
                            <span class="truncate">${item.name}</span>
                        </button>
                    `;
                }).join('');

                html += `
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden transition-all duration-300">
                        <div onclick="toggleGroup(${groupIdx})" class="p-4 cursor-pointer bg-white hover:bg-gray-50 transition-colors flex justify-between items-center">
                            <h2 class="font-extrabold text-sm text-gray-800 uppercase tracking-widest">
                                ${group.title}
                            </h2>
                            <i data-lucide="chevron-down" class="w-4 h-4 transition-transform duration-300 ${isOpen ? 'rotate-180 text-blue-600' : 'text-gray-400'}"></i>
                        </div>
                        <div class="submenu-container ${isOpen ? 'open' : ''} bg-white px-3 pb-3 pt-1 space-y-1 border-t border-gray-50">
                            ${itemsHtml}
                        </div>
                    </div>
                `;
            });

            html += `
                <div class="p-4 bg-gray-100 rounded-xl border border-gray-200 text-xs text-gray-500 leading-relaxed mt-8">
                    <strong>免責事項：</strong><br/>
                    各グラフは、世銀・IMF等の統計や歴史的転換点を基に生成された<strong>推計シミュレーション</strong>です。
                </div>
            `;

            sidebar.innerHTML = html;
            lucide.createIcons();
        }

        // ==========================================
        // 5. メインコンテンツレンダリング関数
        // ==========================================
        function renderMainContent() {
            const container = document.getElementById('main-content');
            
            // 既存のチャートを破棄
            activeCharts.forEach(chart => chart.destroy());
            activeCharts = [];

            const id = state.selectedMenuItem;

            if (id === 'view_overview') {
                container.innerHTML = `
                    <div class="space-y-8 animate-fade-in">
                        <div class="bg-white rounded-2xl shadow-sm p-8 border-l-8 border-blue-500">
                            <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                                <i data-lucide="book-open" class="text-blue-500"></i> レンティア国家のパラドックス
                            </h2>
                            <p class="text-gray-600 leading-relaxed mb-4">
                                「石油があれば国が豊かになり、民主化が進む」という近代化論は、多くの産油国で否定されています。国家収入の大部分を天然資源の輸出（地代＝レント）に依存する<b>「レンティア国家」</b>では、政府は国民から税を徴収する必要がなく、その結果、「代表なくして課税なし」の逆転現象が生じます。
                            </p>
                            <p class="text-gray-600 leading-relaxed">
                                本ダッシュボードでは、<b>「国家能力（State Capacity）」</b>と<b>「制度の質」</b>という視点から、ノルウェーの成功、マレーシアの開発、サウジアラビアの洗練された独裁、そしてベネズエラの国家崩壊の違いを時系列データを通して解き明かします。
                            </p>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 hover:shadow-md transition-all">
                                <div class="mb-4"><i data-lucide="droplets" class="text-blue-600"></i></div>
                                <h3 class="font-bold text-gray-800 mb-2">レント依存と無税国家</h3>
                                <p class="text-sm text-gray-500 leading-relaxed">政府収入が石油に依存するため、国民への課税が不要になる。これにより国民は政府を監視する「納税者としての権利」を失う。</p>
                            </div>
                            <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 hover:shadow-md transition-all">
                                <div class="mb-4"><i data-lucide="zap" class="text-blue-600"></i></div>
                                <h3 class="font-bold text-gray-800 mb-2">福祉による懐柔</h3>
                                <p class="text-sm text-gray-500 leading-relaxed">独裁政権は莫大なオイルマネーで「アメ（補助金・雇用）」を配り、政治的沈黙を買う。これをレンティア社会契約と呼ぶ。</p>
                            </div>
                            <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 hover:shadow-md transition-all">
                                <div class="mb-4"><i data-lucide="shield-check" class="text-blue-600"></i></div>
                                <h3 class="font-bold text-gray-800 mb-2">制度の呪い</h3>
                                <p class="text-sm text-gray-500 leading-relaxed">資源価格の高騰は民主化を促すのではなく、独裁者が抑圧装置を強化し、既存の制度を腐敗させる資金源となる。</p>
                            </div>
                        </div>
                    </div>
                `;
            } else if (id === 'view_levels') {
                let cardsHtml = allEntities.filter(c => !['jp', 'la', 'world'].includes(c.key)).map(c => {
                    let text = "";
                    if (c.level === 'L1') text = "資源発見前に民主制度が確立。包括的制度により資源収入は将来世代のために貯蓄される。";
                    if (c.level === 'L2') text = "製造業などへの多角化に成功。中間層が育ち、政府は資源以外からも徴税するため一定の民主主義が機能。";
                    if (c.level === 'L3') text = "圧倒的資源収入で「無税・高福祉」を実現。国家能力（抑圧と分配）は高く、体制は安定している。";
                    if (c.level === 'L4') text = "国家機構自体が腐敗・崩壊。国民を養う能力も抑圧する能力も欠如し、国家の解体が進む。";
                    
                    let exp = c.level === 'L1' ? '極めて高い' : (c.level === 'L2' ? '中程度' : '極めて低い');
                    let sur = c.level === 'L4' ? '危機的' : '安定';

                    return `
                    <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden flex flex-col md:flex-row">
                        <div class="md:w-1/4 p-6 flex flex-col justify-center items-center text-center" style="background-color: ${c.color}15">
                            <span class="text-xs font-black uppercase tracking-widest opacity-60 mb-1" style="color: ${c.color}">${c.level}</span>
                            <h3 class="font-bold text-gray-800 text-lg" style="color: ${c.color}">${c.name}</h3>
                            <p class="text-[11px] text-gray-500 mt-1">${c.desc}</p>
                        </div>
                        <div class="flex-grow p-6 grid grid-cols-1 md:grid-cols-2 gap-4 border-t md:border-t-0 md:border-l border-gray-50">
                            <div>
                                <p class="text-xs font-bold text-gray-400 uppercase mb-2">統治の特徴</p>
                                <p class="text-sm text-gray-600 leading-relaxed">${text}</p>
                            </div>
                            <div class="bg-gray-50 rounded-lg p-4 flex flex-col justify-center gap-3">
                                <div class="flex justify-between items-center text-xs">
                                    <span class="text-gray-500 font-medium">民主化期待値</span>
                                    <span class="font-bold bg-white px-2 py-1 rounded border border-gray-200 shadow-sm">${exp}</span>
                                </div>
                                <div class="flex justify-between items-center text-xs">
                                    <span class="text-gray-500 font-medium">国家の存続性</span>
                                    <span class="font-bold bg-white px-2 py-1 rounded border border-gray-200 shadow-sm">${sur}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    `;
                }).join('');

                container.innerHTML = `
                    <div class="space-y-6 animate-fade-in">
                        <div class="mb-4 text-center max-w-2xl mx-auto">
                            <h2 class="text-2xl font-bold text-gray-800">レンティア国家の4つの統治レベル</h2>
                            <p class="text-gray-500 mt-2 text-sm">国家が資源なしで機能できる「国家能力」を基準とした分類</p>
                        </div>
                        <div class="grid grid-cols-1 gap-4">
                            ${cardsHtml}
                        </div>
                    </div>
                `;
            } else if (id === 'view_comparative') {
                container.innerHTML = `
                    <div class="space-y-6 animate-fade-in">
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-200">
                                <h3 class="text-lg font-bold text-gray-800 mb-1">国家能力 vs 民主化レベル (2025年推定)</h3>
                                <p class="text-xs text-gray-400 mb-6">縦軸: 政府効率性 | 横軸: 民主化指数 | バブル: 石油依存度</p>
                                <div class="small-chart-container"><canvas id="scatterChart"></canvas></div>
                            </div>
                            <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-200">
                                <h3 class="text-lg font-bold text-gray-800 mb-1">政府歳入における石油収入比率</h3>
                                <p class="text-xs text-gray-400 mb-6">比率が高いほど、独裁体制の維持や制度崩壊のリスクが上昇する</p>
                                <div class="small-chart-container"><canvas id="rentBarChart"></canvas></div>
                            </div>
                        </div>
                    </div>
                `;

                // Scatter Chart
                const scatterDataList = allEntities.filter(c => !['la', 'world'].includes(c.key)).map(c => ({
                    label: c.name,
                    data: [{ x: latestData[`${c.key}_democracy`], y: latestData[`${c.key}_gov_effectiveness`], r: Math.max(4, Math.sqrt(latestData[`${c.key}_oil_revenue_gov`] || 0) * 1.5) }],
                    backgroundColor: c.color + 'CC',
                    borderColor: c.color
                }));

                const ctxScatter = document.getElementById('scatterChart').getContext('2d');
                activeCharts.push(new Chart(ctxScatter, {
                    type: 'bubble',
                    data: { datasets: scatterDataList },
                    options: {
                        responsive: true, maintainAspectRatio: false,
                        plugins: { legend: { display: false }, tooltip: {
                            callbacks: {
                                label: function(ctx) {
                                    const d = ctx.raw;
                                    return `${ctx.dataset.label} - 民主化: ${d.x.toFixed(1)}, 能力: ${d.y.toFixed(2)}`;
                                }
                            }
                        }},
                        scales: {
                            x: { title: { display: true, text: '民主化指数' }, min: 0, max: 10 },
                            y: { title: { display: true, text: '国家能力' }, min: -2.5, max: 2.5 }
                        }
                    }
                }));

                // Rent Bar Chart
                const rentLabels = [];
                const rentData = [];
                const rentColors = [];
                allEntities.filter(c => !['jp', 'la', 'world'].includes(c.key)).forEach(c => {
                    rentLabels.push(c.name);
                    rentData.push(latestData[`${c.key}_oil_revenue_gov`] || 0);
                    rentColors.push(c.color);
                });

                const ctxRent = document.getElementById('rentBarChart').getContext('2d');
                activeCharts.push(new Chart(ctxRent, {
                    type: 'bar',
                    data: {
                        labels: rentLabels,
                        datasets: [{ data: rentData, backgroundColor: rentColors, borderRadius: 4 }]
                    },
                    options: {
                        responsive: true, maintainAspectRatio: false,
                        plugins: { legend: { display: false }, tooltip: {
                            callbacks: { label: function(ctx) { return ctx.raw.toFixed(1) + '%'; } }
                        }},
                        scales: { y: { beginAtZero: true, max: 100, ticks: { callback: v => v + '%' } } }
                    }
                }));

            } else if (id === 'view_diversification') {
                container.innerHTML = `
                    <div class="space-y-8 animate-fade-in">
                        <div class="bg-white rounded-2xl shadow-sm p-8 border-l-8 border-emerald-500">
                            <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                                <i data-lucide="factory" class="text-emerald-500"></i> オランダ病と経済の多角化 (Economic Diversification)
                            </h2>
                            <p class="text-gray-600 leading-relaxed mb-4">
                                資源ブームによって自国通貨が実質的に増価（為替レートが上昇）し、製造業や農業など他の輸出産業の国際競争力が失われる現象を<b>「オランダ病（Dutch Disease）」</b>と呼びます。資源収入に依存する国家が長期的な安定を築くためには、この罠を回避し、経済を多角化させることが不可欠です。
                            </p>
                            <p class="text-gray-600 leading-relaxed">
                                資源の枯渇や価格変動リスクに備えるため、近年多くの産油国が「脱石油」を掲げています。ここでは、各国の多角化へのアプローチと現状を比較します。
                            </p>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                                <h3 class="font-bold text-gray-800 border-b pb-2 mb-4 text-lg">成功例：早期の多角化と主権富裕ファンド</h3>
                                <div class="space-y-4">
                                    <div class="p-4 bg-emerald-50 rounded-lg border border-emerald-100">
                                        <h4 class="font-bold text-emerald-800 mb-1">マレーシア (L2)</h4>
                                        <p class="text-sm text-emerald-700 leading-relaxed">1970年代から積極的に外資を誘致し、電気電子産業を中心とした製造業の育成に成功。石油収入（ペトロナス）は国家予算を支えつつも、輸出の大半は工業製品が占める堅牢な経済構造を構築しました。</p>
                                    </div>
                                    <div class="p-4 bg-emerald-50 rounded-lg border border-emerald-100">
                                        <h4 class="font-bold text-emerald-800 mb-1">ノルウェー (L1)</h4>
                                        <p class="text-sm text-emerald-700 leading-relaxed">石油収入を国内に還流させず、政府年金基金グローバル（主権富裕ファンド）として海外資産に投資。国内のインフレと自国通貨高（オランダ病）を未然に防ぎ、非石油部門の競争力を維持しています。</p>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                                <h3 class="font-bold text-gray-800 border-b pb-2 mb-4 text-lg">移行期と失敗例：トップダウン改革と崩壊</h3>
                                <div class="space-y-4">
                                    <div class="p-4 bg-amber-50 rounded-lg border border-amber-100">
                                        <h4 class="font-bold text-amber-800 mb-1">サウジアラビア (L3)</h4>
                                        <p class="text-sm text-amber-700 leading-relaxed">「ビジョン2030」を掲げ、エンターテインメント、観光、ITなど非石油部門の育成をトップダウンで急進的に進めています。しかし、依然として国家予算の大部分を石油に依存しており、真の多角化への途上にあります。</p>
                                    </div>
                                    <div class="p-4 bg-red-50 rounded-lg border border-red-100">
                                        <h4 class="font-bold text-red-800 mb-1">ベネズエラ (L4)</h4>
                                        <p class="text-sm text-red-700 leading-relaxed">典型的なオランダ病に陥り、石油ブーム期に国内の農業・製造業が壊滅。さらに価格統制や外貨規制が民間投資を阻害し、原油価格の下落とともに経済全体が機能不全に陥りました。</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (id === 'view_exodus') {
                container.innerHTML = `
                    <div class="space-y-6 animate-fade-in">
                        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 md:p-8">
                            <div class="mb-6 border-b border-gray-100 pb-6">
                                <h2 class="text-2xl md:text-3xl font-bold text-gray-800 mb-3 flex items-center gap-2">
                                    <i data-lucide="users" class="text-indigo-500 w-8 h-8"></i> ベネズエラからの巨大な頭脳流出と難民危機（1999-2024）
                                </h2>
                                <p class="text-gray-600 text-sm md:text-base">総人口の約25%にあたる約770万人が国を捨てた「4つの波」と主要な行き先</p>
                                <p class="text-xs text-gray-400 mt-2">※参照元：UNHCR、IOM、R4V（ベネズエラ難民・移民に関する地域省庁間調整プラットフォーム）、ENCOVI</p>
                            </div>
                            <div class="mb-8 bg-gray-50 p-5 rounded-lg border border-gray-200 shadow-sm">
                                <h3 class="text-lg font-bold text-gray-700 mb-2">🗺️ 主要な受け入れ国と推定難民・移民数（2023-2024年時点）</h3>
                                <p class="text-sm text-gray-500 mb-6">当初は隣国コロンビアが最大の受け皿でしたが、近年はペルー、チリ、米国などへ目的地が拡散しています。※不法越境者が多く、実際の数はこれを大きく上回ると推測されます。</p>
                                <div class="small-chart-container"><canvas id="exodusChart"></canvas></div>
                            </div>
                            <!-- Table -->
                            <div class="border border-gray-200 rounded-lg overflow-hidden mb-8">
                                <h3 class="text-lg font-bold text-gray-800 bg-gray-100 p-4 border-b border-gray-200">🌊 時期別：脱出の「4つの波」と階層的変化</h3>
                                <div class="overflow-x-auto">
                                    <table class="min-w-full text-sm text-left">
                                        <thead class="bg-gray-50 text-gray-700">
                                            <tr>
                                                <th class="py-3 px-4 font-semibold border-b w-1/6">時期・波</th>
                                                <th class="py-3 px-4 font-semibold border-b w-1/5">脱出した主な階層・職種</th>
                                                <th class="py-3 px-4 font-semibold border-b w-1/4">脱出の理由・特徴</th>
                                                <th class="py-3 px-4 font-semibold border-b w-1/6">主要な行き先</th>
                                                <th class="py-3 px-4 font-semibold border-b text-right">推定人数</th>
                                            </tr>
                                        </thead>
                                        <tbody class="divide-y divide-gray-100">
                                            <tr class="hover:bg-gray-50 transition-colors">
                                                <td class="py-3 px-4"><span class="font-bold text-gray-800 block">第1波：頭脳流出</span><span class="text-xs text-gray-500">1999年 〜 2003年</span></td>
                                                <td class="py-3 px-4 text-gray-700">富裕層、企業経営者、PDVSAの熟練技術者（ストライキ解雇者）、医師・エンジニア</td>
                                                <td class="py-3 px-4 text-gray-600"><strong>【政治的危機と解雇】</strong>チャベス政権誕生に対する社会不安と、2002年の国営石油（PDVSA）ストライキ後の大量解雇（約2万人）が引き金。</td>
                                                <td class="py-3 px-4 text-gray-600">🇺🇸 米国（マイアミ等）<br/>🇪🇸 スペイン</td>
                                                <td class="py-3 px-4 text-right font-semibold text-gray-700">約 10万〜20万人</td>
                                            </tr>
                                            <tr class="hover:bg-gray-50 transition-colors">
                                                <td class="py-3 px-4"><span class="font-bold text-gray-800 block">第2波：中産階級の流出</span><span class="text-xs text-gray-500">2004年 〜 2013年</span></td>
                                                <td class="py-3 px-4 text-gray-700">中産階級、若手専門家、大学卒業生、中小起業家</td>
                                                <td class="py-3 px-4 text-gray-600"><strong>【経済統制と治安悪化】</strong>厳格な外貨統制（CADIVI）によるビジネス環境の悪化、企業の強制収用、および世界最悪レベルに達した殺人率の上昇。</td>
                                                <td class="py-3 px-4 text-gray-600">🇺🇸 米国、🇪🇸 スペイン、<br/>🇨🇴 コロンビア、🇵🇦 パナマ</td>
                                                <td class="py-3 px-4 text-right font-semibold text-gray-700">約 50万〜80万人</td>
                                            </tr>
                                            <tr class="hover:bg-blue-50 transition-colors bg-blue-50/30">
                                                <td class="py-3 px-4"><span class="font-bold text-blue-800 block">第3波：生存のための脱出</span><span class="text-xs text-blue-600">2014年 〜 2019年</span></td>
                                                <td class="py-3 px-4 text-blue-900 font-medium">労働者階級、低所得層、農民、先住民、若年層</td>
                                                <td class="py-3 px-4 text-blue-800"><strong>【ハイパーインフレと飢餓】</strong>原油暴落と経済崩壊による「食料と医薬品の絶対的枯渇」。全財産を売り払い、バスや徒歩で国境を越える悲惨な難民化現象。</td>
                                                <td class="py-3 px-4 text-blue-800">🇨🇴 コロンビア、🇵🇪 ペルー、<br/>🇪🇨 エクアドル、🇨🇱 チリ</td>
                                                <td class="py-3 px-4 text-right font-bold text-blue-700 text-lg">約 400万〜450万人</td>
                                            </tr>
                                            <tr class="hover:bg-rose-50 transition-colors bg-rose-50/40">
                                                <td class="py-3 px-4"><span class="font-bold text-rose-800 block">第4波：絶望の連鎖</span><span class="text-xs text-rose-600">2020年 〜 2024年(現在)</span></td>
                                                <td class="py-3 px-4 text-rose-900 font-medium">残された最貧困層、家族との再統合を求める人々</td>
                                                <td class="py-3 px-4 text-rose-800"><strong>【ダリエン地峡ルートの急増】</strong>「マドゥロ政権は終わらない」という絶望。死のジャングル「ダリエン地峡」を徒歩で越え、米国を目指す極めて危険な不法入国が急増。</td>
                                                <td class="py-3 px-4 text-rose-800">🇺🇸 米国、🇨🇴 コロンビア</td>
                                                <td class="py-3 px-4 text-right font-bold text-rose-700 text-lg">約 200万〜250万人</td>
                                            </tr>
                                            <tr class="bg-gray-100">
                                                <td colspan="4" class="py-3 px-4 text-right font-bold text-gray-800">累計推定（2024年時点・R4V推計）</td>
                                                <td class="py-3 px-4 text-right font-black text-gray-800 text-xl">約 772 万人</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="bg-amber-50 p-6 rounded-lg border border-amber-200">
                                <h3 class="font-bold text-amber-800 mb-2">💡 分析：失われた「世代」と「才能」</h3>
                                <p class="text-sm text-amber-900 leading-relaxed">この大規模な流出の最も残酷な点は、<strong>初期に「国を立て直すために必要な専門家や若者」が先に流出してしまった</strong>ことです。PDVSAの熟練エンジニア、大学教授、医師などの「頭脳流出」がインフラ崩壊をさらに加速させました。そして後期には、貧困により自国で生きていくことができなくなった人々が<strong>「難民」</strong>として周辺国へあふれ出しました。</p>
                            </div>
                        </div>
                    </div>
                `;

                // Exodus Chart (Horizontal Bar)
                const ctxExodus = document.getElementById('exodusChart').getContext('2d');
                activeCharts.push(new Chart(ctxExodus, {
                    type: 'bar',
                    data: {
                        labels: migrationData.map(d => d.country),
                        datasets: [{
                            data: migrationData.map(d => d.value),
                            backgroundColor: migrationData.map(d => d.color),
                            borderRadius: 4
                        }]
                    },
                    options: {
                        indexAxis: 'y', // 横向き
                        responsive: true, maintainAspectRatio: false,
                        plugins: { legend: { display: false }, tooltip: {
                            callbacks: { label: function(ctx) { return '約 ' + (ctx.raw * 100).toFixed(0) + ' 万人'; } }
                        }},
                        scales: { x: { beginAtZero: true, title: { display: true, text: '推定人数 (百万人)' } } }
                    }
                }));

            } else if (id === 'view_social_control') {
                container.innerHTML = `
                    <div class="space-y-6 animate-fade-in">
                        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 md:p-8">
                            <div class="mb-6 border-b border-gray-100 pb-6">
                                <h2 class="text-2xl md:text-3xl font-bold text-gray-800 mb-3 flex items-center gap-2">
                                    <i data-lucide="network" class="text-blue-500 w-8 h-8"></i> ベネズエラ「社会統制」システムの量的拡大
                                </h2>
                                <p class="text-gray-600 text-sm md:text-base">チャベス時代の住民参加組織から、マドゥロ時代の配給・暴力支配ネットワークへの変遷</p>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                                <div class="bg-gray-50 p-5 rounded-lg border border-gray-200 shadow-sm">
                                    <h3 class="text-lg font-bold text-gray-700 mb-1">🏡 住民組織（共同体評議会）の設立数</h3>
                                    <p class="text-xs text-gray-500 mb-4">Consejos Comunales: 地方行政を代替した地域組織</p>
                                    <div class="small-chart-container"><canvas id="consejosChart"></canvas></div>
                                </div>
                                <div class="bg-gray-50 p-5 rounded-lg border border-gray-200 shadow-sm">
                                    <h3 class="text-lg font-bold text-gray-700 mb-1">📦 食料配給委員会（CLAP）の組織数</h3>
                                    <p class="text-xs text-gray-500 mb-4">CLAP: 経済危機後に作られた配給網</p>
                                    <div class="small-chart-container"><canvas id="clapChart"></canvas></div>
                                </div>
                            </div>
                            <!-- Table -->
                            <div class="bg-rose-50 p-6 rounded-lg border border-rose-200 shadow-sm mb-8">
                                <h3 class="text-xl font-bold text-rose-800 mb-2">🏍️ 「コレクティーボ（Colectivos）」の変遷と推計規模</h3>
                                <p class="text-sm text-rose-900 mb-4">非正規の親政権武装グループ。時代と共に役割と武装度が劇的に拡大しています。</p>
                                <div class="overflow-x-auto">
                                    <table class="min-w-full bg-white border border-rose-100 rounded-lg overflow-hidden text-sm text-left">
                                        <thead class="bg-rose-100 text-rose-800">
                                            <tr>
                                                <th class="py-3 px-4 font-semibold">時期</th><th class="py-3 px-4 font-semibold">政権</th><th class="py-3 px-4 font-semibold">組織の性質と主要な出来事</th><th class="py-3 px-4 font-semibold">推計規模・武装度</th>
                                            </tr>
                                        </thead>
                                        <tbody class="divide-y divide-rose-50">
                                            <tr class="hover:bg-rose-50"><td class="py-3 px-4 font-bold text-gray-800">2001-2004</td><td class="py-3 px-4 text-gray-600">チャベス初期</td><td class="py-3 px-4">「ボリバル・サークル」として結成。政府支援の街頭活動や政治集会への動員が主目的。</td><td class="py-3 px-4"><span class="font-semibold text-orange-600">全国で数十万人</span>が登録（大半は非武装）。</td></tr>
                                            <tr class="hover:bg-rose-50"><td class="py-3 px-4 font-bold text-gray-800">2006-2012</td><td class="py-3 px-4 text-gray-600">チャベス後期</td><td class="py-3 px-4">都市部のスラムで、武装化した「コレクティーボ」が定着。特定の地域を「解放区」として警察を排除し支配。</td><td class="py-3 px-4">カラカスを中心に<span class="font-semibold text-orange-600">数十の中核的武装グループ</span>が存在。</td></tr>
                                            <tr class="hover:bg-rose-50"><td class="py-3 px-4 font-bold text-gray-800">2014-2017</td><td class="py-3 px-4 text-rose-600 font-bold">マドゥロ危機</td><td class="py-3 px-4">大規模な反政府デモに対し、政府が「体制の防衛者」として公式に動員。デモ隊を暴力的に鎮圧するパラミリタリーとして機能。</td><td class="py-3 px-4">銃器で武装した中核メンバーが<span class="font-bold text-rose-600">推定5,000〜7,000人</span>規模。</td></tr>
                                            <tr class="hover:bg-rose-50"><td class="py-3 px-4 font-bold text-gray-800">2018-現在</td><td class="py-3 px-4 text-rose-600 font-bold">マドゥロ統制</td><td class="py-3 px-4">国家治安部隊との一体化が進行。食料配給（CLAP）の監視や、闇市場・ガソリン密売の利権を掌握し、マフィア化。</td><td class="py-3 px-4">全国規模でネットワーク化され、<span class="font-bold text-rose-600">重武装メンバー約1万人</span>。</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="bg-blue-50 p-6 rounded-lg border border-blue-200">
                                <h3 class="font-bold text-blue-800 mb-2">💡 分析：参加型デモクラシーから「生存の従属」へ</h3>
                                <p class="text-sm text-blue-900 leading-relaxed">チャベス時代に作られた「共同体評議会」は、当初は参加型民主主義の象徴でした。しかし経済崩壊後、政府はこのネットワークを利用してCLAP（食料配給）を開始。これにより、政府を支持しない住民には<strong>「食料の配給を停止する」という致命的な脅し（ソーシャル・コントロール）</strong>が可能になりました。</p>
                            </div>
                        </div>
                    </div>
                `;

                activeCharts.push(new Chart(document.getElementById('consejosChart').getContext('2d'), {
                    type: 'line',
                    data: { labels: consejosData.map(d=>d.year), datasets: [{ data: consejosData.map(d=>d.value), borderColor: '#0ea5e9', borderWidth: 3, tension: 0.3, pointBackgroundColor: '#fff', pointBorderColor: '#0ea5e9', pointRadius: 4, fill: true, backgroundColor: 'rgba(14, 165, 233, 0.2)' }] },
                    options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } }
                }));

                activeCharts.push(new Chart(document.getElementById('clapChart').getContext('2d'), {
                    type: 'bar',
                    data: { labels: clapData.map(d=>d.year), datasets: [{ data: clapData.map(d=>d.value), backgroundColor: '#f59e0b', borderRadius: 4 }] },
                    options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true, max: 50000 } } }
                }));

            } else if (id === 'view_corruption_cases') {
                container.innerHTML = `
                    <div class="space-y-6 animate-fade-in">
                        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 md:p-8">
                            <div class="mb-6 border-b border-gray-100 pb-6">
                                <h2 class="text-2xl md:text-3xl font-bold text-gray-800 mb-3 flex items-center gap-2">
                                    <i data-lucide="dollar-sign" class="text-red-600 w-8 h-8"></i> ベネズエラ歴代政権の巨大汚職・公金消失の規模
                                </h2>
                                <p class="text-gray-600 text-sm md:text-base">プントフィホ期 〜 チャベス期 〜 マドゥロ期の代表的な推計値（単位：10億米ドル）</p>
                            </div>
                            <div class="mb-8 bg-gray-50 p-5 rounded-lg border border-gray-200 shadow-sm">
                                <h3 class="text-lg font-bold text-gray-700 mb-2">📊 各時代の「最大級の汚職/資金消失」推計額の比較</h3>
                                <p class="text-sm text-gray-500 mb-6">チャベス期の原油ブーム時に最も巨額の資金が流出しましたが、マドゥロ期の消失額は「経済規模（GDP）に対する破壊力」が極めて高いのが特徴です。</p>
                                <div class="small-chart-container"><canvas id="corruptChart"></canvas></div>
                            </div>
                            <div class="border border-gray-200 rounded-lg overflow-hidden mb-8">
                                <h3 class="text-lg font-bold text-gray-800 bg-gray-100 p-4 border-b border-gray-200">📋 時代別の主な巨大汚職・スキャンダル一覧</h3>
                                <div class="overflow-x-auto">
                                    <table class="min-w-full text-sm text-left">
                                        <thead class="bg-gray-50 text-gray-700">
                                            <tr><th class="py-3 px-4 font-semibold border-b">時代</th><th class="py-3 px-4 font-semibold border-b">事件・メカニズム名</th><th class="py-3 px-4 font-semibold border-b">推計規模</th><th class="py-3 px-4 font-semibold border-b">概要・手口</th></tr>
                                        </thead>
                                        <tbody class="divide-y divide-gray-100">
                                            <tr class="hover:bg-gray-50"><td class="py-3 px-4 text-gray-800 font-medium" rowspan="2">プントフィホ期</td><td class="py-3 px-4 font-semibold text-gray-700">全体推計</td><td class="py-3 px-4 text-rose-600 font-bold">約1,000億ドル</td><td class="py-3 px-4 text-gray-600">約25年間で汚職や無駄遣いによって失われたとされる国富の総額。</td></tr>
                                            <tr class="hover:bg-gray-50"><td class="py-3 px-4 font-semibold text-gray-700">RECADI事件</td><td class="py-3 px-4 text-rose-600 font-bold">数十億ドル</td><td class="py-3 px-4 text-gray-600">1980年代の複数為替制度（RECADI）を利用した大規模な横領。</td></tr>
                                            <tr class="hover:bg-blue-50 bg-blue-50/20"><td class="py-3 px-4 text-gray-800 font-medium" rowspan="3">チャベス期</td><td class="py-3 px-4 font-semibold text-gray-700">CADIVIと架空企業</td><td class="py-3 px-4 text-rose-600 font-bold text-lg">約3,000億ドル</td><td class="py-3 px-4 text-gray-600"><strong>【歴史上最大規模】</strong> 厳格な外貨統制の裏で、政権幹部がペーパーカンパニーを使って優遇レートのドルを不当に引き出し、海外に持ち去った総額。</td></tr>
                                            <tr class="hover:bg-blue-50 bg-blue-50/20"><td class="py-3 px-4 font-semibold text-gray-700">PDVSAからの資金消失</td><td class="py-3 px-4 text-rose-600 font-bold">約110億ドル</td><td class="py-3 px-4 text-gray-600">国営石油会社PDVSAから使途不明で消失した巨額資金（国会調査）。</td></tr>
                                            <tr class="hover:bg-blue-50 bg-blue-50/20"><td class="py-3 px-4 font-semibold text-gray-700">国家財務官の収賄</td><td class="py-3 px-4 text-rose-600 font-bold">約10億ドル</td><td class="py-3 px-4 text-gray-600">為替取引の便宜を図る見返りに受け取った賄賂の額。</td></tr>
                                            <tr class="hover:bg-rose-50 bg-rose-50/30"><td class="py-3 px-4 text-gray-800 font-medium" rowspan="2">マドゥロ期</td><td class="py-3 px-4 font-semibold text-gray-700">PDVSA-Cripto事件</td><td class="py-3 px-4 text-rose-600 font-bold">約210億ドル</td><td class="py-3 px-4 text-gray-600">制裁逃れのために暗号資産を使って石油を密売した結果、売上金の大半が国庫に入らず消失した事件。</td></tr>
                                            <tr class="hover:bg-rose-50 bg-rose-50/30"><td class="py-3 px-4 font-semibold text-gray-700">CLAPと資金洗浄</td><td class="py-3 px-4 text-rose-600 font-bold">数十億ドル規模</td><td class="py-3 px-4 text-gray-600">食料配給（CLAP）において、粗悪な食料を過大請求して暴利を得ていたネットワーク。</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="bg-amber-50 p-6 rounded-lg border border-amber-200">
                                <h3 class="font-bold text-amber-800 mb-2">💡 分析：失われた金額の「相対的な破壊力」</h3>
                                <p class="text-sm text-amber-900 leading-relaxed">絶対的な金額で見るとチャベス期が歴史上類を見ない規模ですが、マドゥロ期の「PDVSA-Cripto事件（約210億ドル消失）」の恐ろしさはその「対GDP比」にあります。当時のベネズエラの推定GDPは1000億ドル未満であり、<strong>国の経済規模の数分の一に匹敵する売上が少数の官僚によって消失させられた</strong>ことになります。</p>
                            </div>
                        </div>
                    </div>
                `;

                activeCharts.push(new Chart(document.getElementById('corruptChart').getContext('2d'), {
                    type: 'bar',
                    data: { labels: corruptionData.map(d=>d.name), datasets: [{ data: corruptionData.map(d=>d.value), backgroundColor: corruptionData.map(d=>d.color), borderRadius: 4, barPercentage: 0.5 }] },
                    options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true, title: { display: true, text: '10億米ドル' } } } }
                }));

            } else if (id === 'view_military_control') {
                container.innerHTML = `
                    <div class="space-y-6 animate-fade-in">
                        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 md:p-8">
                            <div class="mb-6 border-b border-gray-100 pb-6">
                                <h2 class="text-2xl md:text-3xl font-bold text-gray-800 mb-3 flex items-center gap-2">
                                    <i data-lucide="crosshair" class="text-red-600 w-8 h-8"></i> ベネズエラ：軍の政治・経済支配の変遷
                                </h2>
                                <p class="text-gray-600 text-sm md:text-base">閣僚ポストに占める軍人（現役・退役）の割合と、経済支配の拡大</p>
                            </div>
                            <div class="mb-8 bg-gray-50 p-5 rounded-lg border border-gray-200 shadow-sm">
                                <h3 class="text-lg font-bold text-gray-700 mb-2">📊 歴代内閣（閣僚ポスト）に占める軍人の割合推移</h3>
                                <div class="small-chart-container"><canvas id="milChart"></canvas></div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                                <div class="bg-white border border-blue-200 rounded-lg p-5 shadow-sm">
                                    <h3 class="font-bold text-lg text-gray-800 mb-2 border-b border-blue-100 pb-2">1️⃣ プントフィホ期</h3>
                                    <p class="text-sm font-semibold text-blue-600 mb-3">【文民統制の時代】</p>
                                    <ul class="text-sm text-gray-700 space-y-2 list-disc pl-4"><li>軍を意図的に政治から遠ざけた。内閣の軍人は平均3〜5%程度。</li></ul>
                                </div>
                                <div class="bg-white border border-rose-200 rounded-lg p-5 shadow-sm">
                                    <h3 class="font-bold text-lg text-gray-800 mb-2 border-b border-rose-100 pb-2">2️⃣ チャベス期</h3>
                                    <p class="text-sm font-semibold text-rose-600 mb-3">【軍民同盟の時代】</p>
                                    <ul class="text-sm text-gray-700 space-y-2 list-disc pl-4"><li>内閣の約25〜30%に軍人を登用。政治の「軍事化」が始まる。</li></ul>
                                </div>
                                <div class="bg-white border border-red-200 rounded-lg p-5 shadow-sm">
                                    <h3 class="font-bold text-lg text-gray-800 mb-2 border-b border-red-100 pb-2">3️⃣ マドゥロ期</h3>
                                    <p class="text-sm font-semibold text-red-700 mb-3">【軍の覇権の時代】</p>
                                    <ul class="text-sm text-gray-700 space-y-2 list-disc pl-4"><li>政権維持のため軍に過度に依存。現在、国家の主要産業とインフラを軍が合法的に直接支配。</li></ul>
                                </div>
                            </div>
                            <div class="bg-red-50 p-6 rounded-lg border border-red-200">
                                <h3 class="text-xl font-bold text-red-800 mb-4">🏭 マドゥロ期における「軍の経済支配」の具体例</h3>
                                <p class="text-sm text-red-900 mb-6 leading-relaxed">約500の国営企業のうち、少なくとも60〜70の最重要国営企業のトップが軍人によって占められています。</p>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="bg-white p-4 rounded border border-red-100 shadow-sm"><h4 class="font-bold text-gray-800 mb-1">🛢️ 石油・鉱業の支配</h4><p class="text-sm text-gray-600">軍直属の石油会社「CAMIMPEG」の設立。鉱業利権の管轄。</p></div>
                                    <div class="bg-white p-4 rounded border border-red-100 shadow-sm"><h4 class="font-bold text-gray-800 mb-1">📦 食料・物流の支配</h4><p class="text-sm text-gray-600">港湾、流通、食料配給（CLAP）の全権を軍が掌握。</p></div>
                                    <div class="bg-white p-4 rounded border border-red-100 shadow-sm"><h4 class="font-bold text-gray-800 mb-1">🚢 インフラの支配</h4><p class="text-sm text-gray-600">港湾管理、航空、電力などのトップを軍人が歴任。</p></div>
                                    <div class="bg-white p-4 rounded border border-red-100 shadow-sm"><h4 class="font-bold text-gray-800 mb-1">🏦 金融ネットワーク</h4><p class="text-sm text-gray-600">軍人専用の銀行や企業など、独立した経済圏の構築。</p></div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                activeCharts.push(new Chart(document.getElementById('milChart').getContext('2d'), {
                    type: 'line',
                    data: { 
                        labels: militaryCabinetData.map(d=>d.year), 
                        datasets: [{ 
                            data: militaryCabinetData.map(d=>d.value), borderColor: '#475569', borderWidth: 3, tension: 0.3,
                            pointBackgroundColor: militaryCabinetData.map(d=>getPointColor(d.era)), pointBorderColor: '#fff', pointRadius: 6, pointHoverRadius: 9
                        }] 
                    },
                    options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true, max: 50, ticks: { callback: v=>v+'%' } } } }
                }));

            } else {
                // 通常の指標グラフ
                const metricDef = allMetricsList.find(m => m.id === id);
                if (!metricDef) return;

                const isVzlaSpecial = id.startsWith('vzla_');
                const activeEntitiesList = isVzlaSpecial ? [] : Object.keys(ptsMap[id] || {});

                let chartHtml = `<div class="chart-container"><canvas id="mainChart"></canvas></div>`;
                
                let extraHtml = '';
                if (isVzlaSpecial) {
                    let desc = '';
                    if(id === 'vzla_fonden') desc = '議会の監視を受けない「オフ・バジェット」資金の推移。';
                    if(id === 'vzla_pdvsa') desc = '投資不足と熟練工解雇による物理的な生産能力の喪失。';
                    if(id === 'vzla_hire') desc = '専門的な官僚機構から政治的忠誠に基づいた組織への変容。';
                    
                    extraHtml = `
                        <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="bg-amber-50 border border-amber-200 p-5 rounded-xl">
                                <h4 class="flex items-center gap-2 text-amber-700 font-bold mb-2"><i data-lucide="info" class="w-4 h-4"></i> 証拠能力の解説</h4>
                                <p class="text-sm text-amber-900 leading-relaxed">${desc}</p>
                            </div>
                        </div>
                    `;
                }

                container.innerHTML = `
                    <div class="space-y-6 flex flex-col animate-fade-in">
                        <div class="bg-white p-5 md:p-8 rounded-xl shadow-sm border border-gray-200">
                            <div class="mb-6 flex flex-col md:flex-row md:items-center justify-between">
                                <div>
                                    <h2 class="text-2xl font-bold text-gray-800 flex items-center gap-2">
                                        ${isVzlaSpecial ? '<i data-lucide="alert-triangle" class="text-amber-500"></i>' : ''} ${metricDef.name}
                                    </h2>
                                </div>
                                ${metricDef.unit ? `<span class="mt-2 md:mt-0 text-xs font-mono bg-gray-100 px-2 py-1 rounded text-gray-600 border border-gray-200">Unit: ${metricDef.unit}</span>` : ''}
                            </div>
                            ${chartHtml}
                        </div>
                        ${extraHtml}
                    </div>
                `;

                // Chart.js 描画
                const ctx = document.getElementById('mainChart').getContext('2d');
                let config = { type: 'line', data: { labels: chartData.map(d => d.year), datasets: [] }, options: { responsive: true, maintainAspectRatio: false, plugins: { tooltip: { mode: 'index', intersect: false } } } };

                if (metricDef.type === 'line' && !isVzlaSpecial) {
                    config.data.datasets = activeEntitiesList.map(entityKey => {
                        const ent = allEntities.find(e => e.key === entityKey);
                        return {
                            label: ent.name,
                            data: chartData.map(d => d[`${entityKey}_${id}`]),
                            borderColor: ent.color,
                            backgroundColor: ent.color,
                            borderWidth: 2,
                            pointRadius: 0,
                            pointHoverRadius: 5,
                            tension: 0.3
                        };
                    });
                } else if (metricDef.type === 'bar') {
                    config.type = 'bar';
                    config.data.datasets = [{ label: 'FONDEN', data: chartData.map(d => d[id]), backgroundColor: '#f59e0b' }];
                } else if (metricDef.type === 'area') {
                    config.data.datasets = [{ label: '稼働率', data: chartData.map(d => d[id]), borderColor: '#ef4444', backgroundColor: 'rgba(239, 68, 68, 0.3)', fill: true, tension: 0.3 }];
                    config.options.scales = { y: { min: 0, max: 100 } };
                } else if (metricDef.type === 'stacked_area') {
                    config.data.datasets = [
                        { label: '正規官僚機構', data: chartData.map(d => d.vzla_regular), borderColor: '#10b981', backgroundColor: 'rgba(16, 185, 129, 0.5)', fill: true },
                        { label: 'ミッション', data: chartData.map(d => d.vzla_mission), borderColor: '#f59e0b', backgroundColor: 'rgba(245, 158, 11, 0.5)', fill: true }
                    ];
                    config.options.scales = { y: { stacked: true, min: 0, max: 100 } };
                    config.options.plugins.tooltip.mode = 'index';
                }

                activeCharts.push(new Chart(ctx, config));
            }
            
            lucide.createIcons();
        }

        // ==========================================
        // 6. イベントハンドラ
        // ==========================================
        window.toggleGroup = function(groupIdx) {
            state.openGroups[groupIdx] = !state.openGroups[groupIdx];
            renderSidebar();
        };

        window.selectMenu = function(id, groupIdx) {
            state.selectedMenuItem = id;
            // 選択したグループを開き、他は閉じる（アコーディオン挙動）
            Object.keys(state.openGroups).forEach(k => {
                state.openGroups[k] = (parseInt(k) === groupIdx);
            });
            renderSidebar();
            renderMainContent();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        };

        // 初期化
        document.addEventListener('DOMContentLoaded', () => {
            renderSidebar();
            renderMainContent();
        });

    </script>
</body>
</html>
